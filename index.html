<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>A simple map</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>

<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
	
<div id='map'></div>
<br/>
<button id='fit'>Zoom to original extent</button>

<script>
//var map_orig_extent = L.LatLng(44, -79.50);
	
L.mapbox.accessToken = 'pk.eyJ1IjoibTlicmFkeSIsImEiOiJjaXNzNHQ0YmowNmM5MnlwaGh3YjJzd3k3In0.-Fu9YD8Qbrw7xRZ-7Ocn6w';
var map = L.mapbox.map('map')
    .setView([44, -79.50], 3);

var baselayers = {
	Dark: L.mapbox.styleLayer('mapbox://styles/mapbox/dark-v9'),
	Satellite: L.mapbox.tileLayer('mapbox.satellite')
};
	
baselayers.Dark.addTo(map);
L.control.layers(baselayers).addTo(map);
/*
// temporary embed picture file from insta
var dummy_img = 'https://instagram.fyhu1-1.fna.fbcdn.net/t51.2885-15/s640x640/sh0.08/e35/14359485_1783094258572210_2020046964690780160_n.jpg?ig_cache_key=MTM0Nzk3Mzg4NTkzMjY4NzEyMQ%3D%3D.2';
*/	
	
// Snow tweet point layer
var geojson_file = 'snow_points.geojson';
var snow_points = L.mapbox.featureLayer()
	.loadURL(geojson_file)
	.on('ready', function(e) {
		// fit map to bounds of all data points (keeping for later use maybe)
		//map.fitBounds(snow_points.getBounds());
		// setup the clustering group
		var clusterGroup = new L.MarkerClusterGroup();
			e.target.eachLayer(function(layer) {
				clusterGroup.addLayer(layer);
			});
			map.addLayer(clusterGroup);
		
		// Snow tweet popups
		snow_points.eachLayer(function(layer) {
			if (!layer.feature.properties.media_url) {
				var htmlcontent = '<h2>'+layer.feature.properties.twitter_handle+'<\/h2><br><small>'+layer.feature.properties.tweet_time+'<\/small>' +
				    '<p>'+layer.feature.properties.tweet_text+'<br \/p>';
			} else {
				var img_url = layer.feature.properties.media_url;
				var htmlcontent = '<h2>'+layer.feature.properties.twitter_handle+'<\/h2>' +
				    '<p>'+layer.feature.properties.tweet_text+'<br \/p>' +
				    '<img src="' + img_url + '" alt="Instagram" style="width:240px;height:240px;">';
			}
			layer.bindPopup(htmlcontent);
		});
	});
/*
// add a button that returns to the original map extent
document.getElementById('fit').addEventListener('click', function() {
    map.setView(map_orig_extent, 3);
});
*/
</script>


</body>
</html>
